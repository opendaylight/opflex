<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="generator" content="Bluefish 1.0.7">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>opflex-sim Program Documentation</title>
</head>


<body>
<font size="2" face="Verdana, Arial, Helvetica, sans-serif" color="#454545">
<h1>The opflex-sim & Service Documentation</h1>
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
<h3>Background:</h3>
The CommandServer.py program is basically a generic muti-threaded server that can easily be exteded.
The Server class is defines a multi-threaded server that provides services by implementations of a 
nested Service interface. It can provide multiple services (defined by multiple service objects) on
multiple ports, and has the ability to dynamically load and instantiate Service classes and add (and remove)
new services at runtime. It logs its actions to a specified stream and limits the number of concurrent connections to specified maximum.</p><br> 
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
The Server class uses a number of nested classes. The Listener class is a thread that waits for connections on a given port. There is one Listener
object for each service the Server is providing. The ConnectionManager class manages the list of current connections to all services.
There is one ConnectionManager shared by all services. When a Listener gets a connection from a client, it passes it to the ConnectionManage, which
rejects it if connection limit has been reached. If the ConnectionManager does not reject a client, it creates a Connection object to handle
the connection. Connection is a thread sub-class, so each service can handle multiple connections at a time, makingthis a multi-threaded server. 
Each Connection object is passed a Service object and invoked its server() method, which is actually what provides the service.</p><br>
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
The Service interface is a psuedo python implementation of an interface. There are a number of test implementations in the CommandServer 
file (echo, time, etc.). These are for testing and demonstration purposes only. The Control class, however, is a non-trivial Service . This service 
provides password-protected runtime access to the server, and allows remote administrator to add and remove services, check the server status,
 and change the current connection limit.</p><br>
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
Finally, the main() method of Server is a standalone program that creates and runs the Server. By specifiing the -c (--control) argument
on the commandline, you can tell this program to create an instance of the Control service so that the server can be administered at runtime. The following
commandline arguments are necessary to run the genericService, which is what is used to provide remote monitoring on remote nodes:<br><br>

<em>./CommandServer.py -c b:7770 -s opflexService:7777 -s consoleService:8888</em>
<br><br>
Where, -c start the Control service on port 7770 and will require 'b' and the password inorder to gain access, and the opflexService
will be started listening on port 7777 with the colsoleService on port 8888. </p><br>

<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
The Program is intended to be completely self contained.<br> 

<!-- <p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
<h3>Download:</h3>
[ <A HREF="http://www.scion-eng.com/u02/devl/workspace/trcFile/src/trcFile.py"><i><font color="blue">trcFile.py</font></i></A> ]
</p>
 -->
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
<h3>Installation:</h3>
The main program file is the CommandService.py. It is also necessary to provide the service's are are instended to be provided in the same 
directory as the CommandServer.py file. This is done such that python loader can find them with minimal effort. To run the program a cmdserve 
<i>#!/usr/bin/env python</i>, which searches $PATH for python and runs it. (Usually env is used to set some environment variables for a program,
e.g. 'env PYTHONPATH=whatever python', but one need not specify any environment variables), this so you don't have to type python then 
the program you wish the interpreter to run - details..........</p><br>

<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
The CommandServer.py is put whereever you desire, but I would recommend putting it in your path somewhere.</p><br>

</font>
<font size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#454545">
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
<b>Note:</b> the *.pyc are the compiled python .py files. As an important speed-up of 
      the start-up time for short programs that use a lot of standard modules, 
      if a file called ~spam.pyc~ exists in the directory where ~test.py~ is 
      found, this is assumed to contain an already-"byte-compiled" version of 
      the module ~spam~. The modification time of the version of ~test.py~ 
      used to create ~test.pyc~ is recorded in ~test.pyc~, and the ~.pyc~ 
      file is ignored if these don't match. So when you run 'python 
      test.py', the python interpreter first looks to see if 'test.pyc' 
      (which is the byte-code compiled version of 'test.py') exists, 
      and if it is more recent than 'test.py'. If so, the interpreter runs 
      it. If it does not exist, or 'test.py' is more recent than it 
      (meaning you have changed the source file), the interpreter first 
      compiles 'test.py' to 'test.pyc'.<br>
      
<font size="2" face="Verdana, Arial, Helvetica, sans-serif" color="#454545">
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
In addition, there is included a start/stop script cmdServer, which contains the necessary script code to support the /etc/init.d/ code to run
the CommandServer.py. Note: if your going to be debugging your Service, don't run like this. The listing:</p><br><br>
<font size="1" face="Courier">
#!/bin/bash<br>
#<br>
#<br>
# Copyright (c) 2014 Cisco Systems, Inc. and others.  All rights reserved.<br>
#<br>
# This program and the accompanying materials are made available under the<br>
# terms of the Eclipse Public License v1.0 which accompanies this distribution,<br>
# and is available at http://www.eclipse.org/legal/epl-v10.html<br>
#<br>
#<br>
# cmdServer<br>
#<br>
# chkconfig: 235 82 20<br>
#<br>
<br>
# source the function library<br>
. /etc/init.d/functions<br>
<br>
PATH=/usr/bin:./:$PATH<br>
PIDFILE=/tmp/cmdServer.pid<br>
basedir=./opflex-sim//src<br>
 <br>
DAEMON=CommandServer.py<br>
CMD_OPTS="-c b:7770 -s opflexService:7777 -s consoleService:8888 -l /tmp/cmdServer.log"<br>
<br>
<br>
start() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;# start the daemon<br>
&nbsp;&nbsp;&nbsp;&nbsp;if test -d "$basedir"<br>
&nbsp;&nbsp;&nbsp;&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd $basedir<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;daemon $DAEMON "$CMD_OPTS" &> /dev/null<br>
&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "Can't find $basedir, terminating!"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;fi<br>
}<br>
<br>
stop() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;if test -s "$PIDFILE"<br>
&nbsp;&nbsp;&nbsp;&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd_pid=`cat $PIDFILE`<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "Shutting down CommandServer.py"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;killproc -p $PIDFILE<br>
&nbsp;&nbsp;&nbsp;&nbsp;fi<br>
}<br>
<br>
# See how we were called.<br>
case "$1" in<br>
&nbsp;&nbsp;&nbsp;&nbsp;start)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo -n $"Starting $DAEMON: "<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;stop)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;restart|reload)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETVAL=$?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
 &nbsp;&nbsp;&nbsp;&nbsp;*)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo $"Usage: $0 {start|stop|restart}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 1<br>
esac<br>
<br>
exit $RETVAL<br>
</font><br>


<font size="2" face="Verdana, Arial, Helvetica, sans-serif" color="#454545">
<h2>Program Options</h2>
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
Using telnet to connect ot the Control service it will provide the following session:</font></p><br>

<font size="1" face="Courier" color="#0000aa">
<p>[dkehn@halt60p src] > telnet mars 7770<br>
Trying 192.168.100.105...<br>
Connected to mars.<br>
Escape character is '^]'.<br>
Server:Control> help<br>
Supported commands:<br>
&nbsp;&nbsp;&nbsp;&nbsp;PassWd password&nbsp;&nbsp;- enter password<br>
&nbsp;&nbsp;&nbsp;&nbsp;STATus&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-  display current services, connections, and connection limit<br>
&nbsp;&nbsp;&nbsp;&nbsp;Quit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- quit this service<br>
&nbsp;&nbsp;&nbsp;&nbsp;Shutdown&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- shut the program down<br>
&nbsp;&nbsp;&nbsp;&nbsp;Max&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- sets the maximum allow connections<br>
&nbsp;&nbsp;&nbsp;&nbsp;Help (?)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- displays the menu<br>
&nbsp;&nbsp;&nbsp;&nbsp;Remove port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- dynamically remove the service running on a specified port<br>
&nbsp;&nbsp;&nbsp;&nbsp;Add service:port&nbsp;- dynamically add a named service on a specified port<br>
<br>
Server:Control><br>
<br><br>
</font></p>

<font size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#454545">
<p style="word-spacing: 0; margin-top: 0; margin-bottom: 0">
The -d option will turn on an extra level of debugging but in general the code will have to be edited where logging.INFO is to set the 
logging level to DEBUG (i.e. logging.DEBUG).</font></p><br>

<br><br><hr>
<FONT SIZE=2 face="Arial" COLOR="black"><CENTER>[ <A HREF="mailto:dkehn@mysql.com"><i><font color="blue">Questions or comments</font></i></A> ]</CENTER></FONT>
<br><br><br>
</body>

</html>
